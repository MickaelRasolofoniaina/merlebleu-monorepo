<div class="flex justify-between items-center mb-4">
  <h2 class="text-2xl font-bold">Utilisateurs</h2>
</div>
<div class="flex justify-end mb-4">
  <p-button label="Ajouter" icon="pi pi-plus" (onClick)="openCreateUserModal()" />
</div>

<p-table
  [value]="users()"
  [loading]="isLoadingUsers"
  [tableStyle]="{ 'min-width': '50rem' }"
  [stripedRows]="true"
>
  <ng-template #header>
    <tr>
      <th>Nom</th>
      <th>Email</th>
      <th>Mot de passe</th>
      <th style="width: 10rem">Actions</th>
    </tr>
  </ng-template>
  <ng-template #body let-user>
    <tr>
      <td>{{ user.name }}</td>
      <td>{{ user.email }}</td>
      <td>********</td>
      <td>
        <p-button
          icon="pi pi-pencil"
          [rounded]="true"
          [outlined]="true"
          severity="warn"
          class="mr-2"
          (onClick)="openEditUserModal(user)"
        />
        <p-button
          icon="pi pi-trash"
          [rounded]="true"
          [outlined]="true"
          severity="danger"
          (onClick)="openDeleteUserModal(user)"
        />
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="displayCreateModal"
  [modal]="true"
  [style]="{ width: '450px' }"
  header="CrÃ©er un utilisateur"
>
  <div class="flex flex-col gap-4">
    <div>
      <label for="userName" class="block mb-2">Nom</label>
      <input
        id="userName"
        type="text"
        pInputText
        [(ngModel)]="createUserDto.name"
        class="w-full"
        placeholder="Entrez le nom"
      />
      @if (getCreateFieldError('name')) {
        <small class="text-red-500 mt-1 block">{{ getCreateFieldError('name') }}</small>
      }
    </div>
    <div>
      <label for="userEmail" class="block mb-2">Email</label>
      <input
        id="userEmail"
        type="email"
        pInputText
        [(ngModel)]="createUserDto.email"
        class="w-full"
        placeholder="Entrez l'email"
      />
      @if (getCreateFieldError('email')) {
        <small class="text-red-500 mt-1 block">{{ getCreateFieldError('email') }}</small>
      }
    </div>
    <div>
      <label for="userPassword" class="block mb-2">Mot de passe</label>
      <p-inputgroup class="w-full">
        <input
          id="userPassword"
          [type]="showPassword ? 'text' : 'password'"
          pInputText
          [(ngModel)]="createUserDto.password"
          placeholder="Entrez le mot de passe"
        />
        <p-inputgroup-addon>
          <p-button
            type="button"
            [icon]="showPassword ? 'pi pi-eye-slash' : 'pi pi-eye'"
            [text]="true"
            severity="secondary"
            (onClick)="togglePasswordVisibility()"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
      @if (getCreateFieldError('password')) {
        <small class="text-red-500 mt-1 block">{{ getCreateFieldError('password') }}</small>
      }
    </div>
    <div>
      <label for="userPasswordConfirm" class="block mb-2">Valider le mot de passe</label>
      <p-inputgroup class="w-full">
        <input
          id="userPasswordConfirm"
          [type]="showPasswordConfirm ? 'text' : 'password'"
          pInputText
          [(ngModel)]="newUserPasswordConfirm"
          placeholder="Confirmez le mot de passe"
        />
        <p-inputgroup-addon>
          <p-button
            type="button"
            [icon]="showPasswordConfirm ? 'pi pi-eye-slash' : 'pi pi-eye'"
            [text]="true"
            severity="secondary"
            (onClick)="togglePasswordConfirmVisibility()"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
      @if (passwordConfirmError) {
        <small class="text-red-500 mt-1 block">{{ passwordConfirmError }}</small>
      }
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button label="Annuler" severity="danger" (onClick)="cancelCreateUser()" />
      <p-button label="Confirmer" (onClick)="confirmCreateUser()" />
    </div>
  </ng-template>
</p-dialog>

<p-dialog
  [(visible)]="displayEditModal"
  [modal]="true"
  [style]="{ width: '450px' }"
  header="Modifier un utilisateur"
>
  <div class="flex flex-col gap-4">
    <div>
      <label for="editUserName" class="block mb-2">Nom</label>
      <input
        id="editUserName"
        type="text"
        pInputText
        [(ngModel)]="editUserDto.name"
        class="w-full"
        placeholder="Entrez le nom"
      />
      @if (getEditFieldError('name')) {
        <small class="text-red-500 mt-1 block">{{ getEditFieldError('name') }}</small>
      }
    </div>
    <div>
      <label for="editUserEmail" class="block mb-2">Email</label>
      <input
        id="editUserEmail"
        type="email"
        pInputText
        [(ngModel)]="editUserDto.email"
        class="w-full"
        placeholder="Entrez l'email"
      />
      @if (getEditFieldError('email')) {
        <small class="text-red-500 mt-1 block">{{ getEditFieldError('email') }}</small>
      }
    </div>
    <div>
      <label for="editUserPassword" class="block mb-2">Mot de passe</label>
      <p-inputgroup class="w-full">
        <input
          id="editUserPassword"
          [type]="showEditPassword ? 'text' : 'password'"
          pInputText
          [(ngModel)]="editUserDto.password"
          placeholder="Entrez le mot de passe"
        />
        <p-inputgroup-addon>
          <p-button
            type="button"
            [icon]="showEditPassword ? 'pi pi-eye-slash' : 'pi pi-eye'"
            [text]="true"
            severity="secondary"
            (onClick)="toggleEditPasswordVisibility()"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
      @if (getEditFieldError('password')) {
        <small class="text-red-500 mt-1 block">{{ getEditFieldError('password') }}</small>
      }
    </div>
    <div>
      <label for="editUserPasswordConfirm" class="block mb-2">Valider le mot de passe</label>
      <p-inputgroup class="w-full">
        <input
          id="editUserPasswordConfirm"
          [type]="showEditPasswordConfirm ? 'text' : 'password'"
          pInputText
          [(ngModel)]="editUserPasswordConfirm"
          placeholder="Confirmez le mot de passe"
        />
        <p-inputgroup-addon>
          <p-button
            type="button"
            [icon]="showEditPasswordConfirm ? 'pi pi-eye-slash' : 'pi pi-eye'"
            [text]="true"
            severity="secondary"
            (onClick)="toggleEditPasswordConfirmVisibility()"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
      @if (editPasswordConfirmError) {
        <small class="text-red-500 mt-1 block">{{ editPasswordConfirmError }}</small>
      }
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button label="Annuler" severity="danger" (onClick)="cancelEditUser()" />
      <p-button label="Confirmer" (onClick)="confirmEditUser()" />
    </div>
  </ng-template>
</p-dialog>

<p-dialog
  [(visible)]="displayDeleteModal"
  [modal]="true"
  [style]="{ width: '450px' }"
  header="Confirmer la suppression"
>
  <div class="flex flex-col gap-4">
    <p>
      Voulez-vous vraiment supprimer l'utilisateur
      <strong>{{ deleteUserName }}</strong> ?
    </p>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button label="Annuler" severity="secondary" (onClick)="cancelDeleteUser()" />
      <p-button label="Supprimer" severity="danger" (onClick)="confirmDeleteUser()" />
    </div>
  </ng-template>
</p-dialog>
